<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% if not is_admin %}ç®¡ç†å“¡ç™»å…¥{% else %}è¨‚å–®ç®¡ç†å¾Œå°{% endif %} - æŸ’æŸ’ chi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body {% if not is_admin %}class="admin-login-body"{% else %}class="admin-body"{% endif %}>

{% if not is_admin %}
    <!-- ç®¡ç†å“¡ç™»å…¥è¡¨å–® -->
    <div class="login-box">
        <h1 class="login-title">ğŸ” ç®¡ç†å“¡ç™»å…¥</h1>
        {% if error %}
            <div class="form-error">{{ error }}</div>
        {% endif %}
        <form method="POST">
            <div class="form-group">
                <label class="form-label">å¸³è™Ÿ</label>
                <input type="text" name="username" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">å¯†ç¢¼</label>
                <input type="password" name="password" class="form-input" required>
            </div>
            <button type="submit" class="form-button">ç™»å…¥</button>
        </form>
    </div>
{% else %}
    <!-- ç®¡ç†å¾Œå° -->
    <div class="admin-container">
        <div class="admin-header">
            <h1 class="admin-title">ğŸ“Š è¨‚å–®ç®¡ç†å¾Œå°</h1>
            <a href="{{ url_for('admin_logout') }}" class="logout-btn">ç™»å‡º</a>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ç¸½è¨‚å–®æ•¸</div>
                <div class="stat-value">{{ stats.total or 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å¾…è™•ç†</div>
                <div class="stat-value">{{ stats.pending or 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å·²ç¢ºèª</div>
                <div class="stat-value">{{ stats.confirmed or 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">å·²å‡ºè²¨</div>
                <div class="stat-value">{{ stats.shipped or 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ç¸½é‘°åŒ™åœˆæ•¸</div>
                <div class="stat-value">{{ stats.total_quantity or 0 }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ç¸½ç‡Ÿæ”¶</div>
                <div class="stat-value">${{ '{:,}'.format(stats.total_revenue or 0) }}</div>
            </div>
        </div>
        
        <div class="filter-bar">
            <a href="{{ url_for('admin') }}?filter=all" class="filter-btn {{ 'active' if filter == 'all' }}">å…¨éƒ¨</a>
            <a href="{{ url_for('admin') }}?filter=pending" class="filter-btn {{ 'active' if filter == 'pending' }}">å¾…è™•ç†</a>
            <a href="{{ url_for('admin') }}?filter=confirmed" class="filter-btn {{ 'active' if filter == 'confirmed' }}">å·²ç¢ºèª</a>
            <a href="{{ url_for('admin') }}?filter=shipped" class="filter-btn {{ 'active' if filter == 'shipped' }}">å·²å‡ºè²¨</a>
            <a href="{{ url_for('admin') }}?filter=completed" class="filter-btn {{ 'active' if filter == 'completed' }}">å·²å®Œæˆ</a>
            <a href="{{ url_for('admin') }}?filter=cancelled" class="filter-btn {{ 'active' if filter == 'cancelled' }}">å·²å–æ¶ˆ</a>
        </div>
        
        <div class="orders-table">
            <table>
                <thead>
                    <tr>
                        <th>è¨‚å–®ç·¨è™Ÿ</th>
                        <th>æœƒå“¡</th>
                        <th>æ”¶ä»¶äºº</th>
                        <th>é›»è©±</th>
                        <th>é–€å¸‚</th>
                        <th>æ•¸é‡</th>
                        <th>é‡‘é¡</th>
                        <th>ä»˜æ¬¾è­‰æ˜</th>
                        <th>ç‹€æ…‹</th>
                        <th>è¨‚è³¼æ™‚é–“</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                    <tr>
                        <td>#{{ order.id }}</td>
                        <td>{{ order.username }}</td>
                        <td>{{ order.recipient_name }}</td>
                        <td>{{ order.phone }}</td>
                        <td>
                            {{ order.store_name }}<br>
                            <small style="opacity: 0.7;">{{ order.store_address }}</small>
                        </td>
                        <td>{{ order.quantity }}</td>
                        <td>${{ '{:,}'.format(order.total_price) }}</td>
                        <td>
                            {% if order.payment_proof %}
                                <a href="{{ url_for('uploaded_file', filename=order.payment_proof) }}" target="_blank" class="view-img">æŸ¥çœ‹</a>
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% set status_texts = {'pending': 'å¾…è™•ç†', 'confirmed': 'å·²ç¢ºèª', 'shipped': 'å·²å‡ºè²¨', 'completed': 'å·²å®Œæˆ', 'cancelled': 'å·²å–æ¶ˆ'} %}
                            <span class="status-badge status-{{ order.status }}">
                                {{ status_texts.get(order.status, order.status) }}
                            </span>
                        </td>
                        <td>{{ order.created_at.strftime('%Y-%m-%d %H:%M') if order.created_at else '' }}</td>
                        <td>
                            <form method="POST" action="{{ url_for('admin_update_status') }}" style="display: inline-flex; align-items: center;">
                                <input type="hidden" name="order_id" value="{{ order.id }}">
                                <select name="status" class="status-select">
                                    <option value="pending" {{ 'selected' if order.status == 'pending' }}>å¾…è™•ç†</option>
                                    <option value="confirmed" {{ 'selected' if order.status == 'confirmed' }}>å·²ç¢ºèª</option>
                                    <option value="shipped" {{ 'selected' if order.status == 'shipped' }}>å·²å‡ºè²¨</option>
                                    <option value="completed" {{ 'selected' if order.status == 'completed' }}>å·²å®Œæˆ</option>
                                    <option value="cancelled" {{ 'selected' if order.status == 'cancelled' }}>å·²å–æ¶ˆ</option>
                                </select>
                                <button type="submit" class="update-btn">æ›´æ–°</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not orders %}
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                            ç›®å‰æ²’æœ‰è¨‚å–®
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
{% endif %}
</body>
</html>
